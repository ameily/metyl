html
  head
    link(href="/vendor/bootstrap/dist/css/bootstrap.min-slate.css", rel="stylesheet")
    link(href="/vendor/polymer/polymer.html", rel="import")
    script(src="/vendor/eventEmitter/EventEmitter.min.js")
    script(src="/public/js/metyl.js")
    link(href="/public/css/metyl.css", rel="stylesheet")
    link(href="/public/polymers/gitlab/merge-request.html", rel="import")
    link(href="/public/polymers/gitlab/commit-push.html", rel="import")

    style.
      #event-list {
        max-width: 100%;
        overflow: hidden;
      }


  body

    div.container-fluid
      div.row
        div.col-md-12
          ul.event-list#event-list

    script(src="/vendor/jquery/dist/jquery.min.js")
    script(src="/vendor/jquery-ui/jquery-ui.min.js")
    script(src="/vendor/bootstrap/dist/js/bootstrap.min.js")
    script.
      var TestEvents = [
        {"object_kind":"merge_request","user":{"name":"Adam Meily","username":"meilya","avatar_url":"https://example.gitlab.lan/uploads/user/avatar/6/walter.jpg"},"project":{"name":"TestProject","description":"","web_url":"https://example.gitlab.lan/meilya/testproject","avatar_url":null,"git_ssh_url":"git@example.gitlab.lan:meilya/testproject.git","git_http_url":"https://example.gitlab.lan/meilya/testproject.git","namespace":"meilya","visibility_level":0,"path_with_namespace":"meilya/testproject","default_branch":"master","homepage":"https://example.gitlab.lan/meilya/testproject","url":"git@example.gitlab.lan:meilya/testproject.git","ssh_url":"git@example.gitlab.lan:meilya/testproject.git","http_url":"https://example.gitlab.lan/meilya/testproject.git"},"object_attributes":{"id":560,"target_branch":"master","source_branch":"branch2","source_project_id":82,"author_id":6,"assignee_id":null,"title":"updated redmine; closes #1111111","created_at":"2016-06-21 23:34:32 UTC","updated_at":"2016-06-21 23:34:32 UTC","milestone_id":null,"state":"opened","merge_status":"unchecked","target_project_id":82,"iid":10,"description":"Some original body content.","position":0,"locked_at":null,"updated_by_id":null,"merge_error":null,"merge_params":{"force_remove_source_branch":"1"},"merge_when_build_succeeds":false,"merge_user_id":null,"merge_commit_sha":null,"deleted_at":null,"source":{"name":"TestProject","description":"","web_url":"https://example.gitlab.lan/meilya/testproject","avatar_url":null,"git_ssh_url":"git@example.gitlab.lan:meilya/testproject.git","git_http_url":"https://example.gitlab.lan/meilya/testproject.git","namespace":"meilya","visibility_level":0,"path_with_namespace":"meilya/testproject","default_branch":"master","homepage":"https://example.gitlab.lan/meilya/testproject","url":"git@example.gitlab.lan:meilya/testproject.git","ssh_url":"git@example.gitlab.lan:meilya/testproject.git","http_url":"https://example.gitlab.lan/meilya/testproject.git"},"target":{"name":"TestProject","description":"","web_url":"https://example.gitlab.lan/meilya/testproject","avatar_url":null,"git_ssh_url":"git@example.gitlab.lan:meilya/testproject.git","git_http_url":"https://example.gitlab.lan/meilya/testproject.git","namespace":"meilya","visibility_level":0,"path_with_namespace":"meilya/testproject","default_branch":"master","homepage":"https://example.gitlab.lan/meilya/testproject","url":"git@example.gitlab.lan:meilya/testproject.git","ssh_url":"git@example.gitlab.lan:meilya/testproject.git","http_url":"https://example.gitlab.lan/meilya/testproject.git"},"last_commit":{"id":"5c73f27b85b0c59d41765ae8b19580fe9e430ac7","message":"updated redmine; closes #1111111\n","timestamp":"2015-03-04T10:41:14-05:00","url":"https://example.gitlab.lan/meilya/testproject/commit/5c73f27b85b0c59d41765ae8b19580fe9e430ac7","author":{"name":"Adam Meily","email":"meilya@ainfosec.com"}},"work_in_progress":false,"url":"https://example.gitlab.lan/meilya/testproject/merge_requests/10","action":"open"},"repository":{"name":"TestProject","url":"git@example.gitlab.lan:meilya/testproject.git","description":"","homepage":"https://example.gitlab.lan/meilya/testproject"}},
        {"object_kind":"note","user":{"name":"Adam Meily","username":"meilya","avatar_url":"https://example.gitlab.lan/uploads/user/avatar/6/walter.jpg"},"project_id":82,"project":{"name":"TestProject","description":"","web_url":"https://example.gitlab.lan/meilya/testproject","avatar_url":null,"git_ssh_url":"git@example.gitlab.lan:meilya/testproject.git","git_http_url":"https://example.gitlab.lan/meilya/testproject.git","namespace":"meilya","visibility_level":0,"path_with_namespace":"meilya/testproject","default_branch":"master","homepage":"https://example.gitlab.lan/meilya/testproject","url":"git@example.gitlab.lan:meilya/testproject.git","ssh_url":"git@example.gitlab.lan:meilya/testproject.git","http_url":"https://example.gitlab.lan/meilya/testproject.git"},"object_attributes":{"id":4601,"note":"Here's a comment.","noteable_type":"MergeRequest","author_id":6,"created_at":"2016-06-21 23:38:23 UTC","updated_at":"2016-06-21 23:38:23 UTC","project_id":82,"attachment":null,"line_code":null,"commit_id":"","noteable_id":560,"system":false,"st_diff":null,"updated_by_id":null,"is_award":false,"type":null,"url":"https://example.gitlab.lan/meilya/testproject/merge_requests/10#note_4601"},"repository":{"name":"TestProject","url":"git@example.gitlab.lan:meilya/testproject.git","description":"","homepage":"https://example.gitlab.lan/meilya/testproject"},"merge_request":{"id":560,"target_branch":"master","source_branch":"branch2","source_project_id":82,"author_id":6,"assignee_id":null,"title":"updated redmine; closes #1111111","created_at":"2016-06-21 23:34:32 UTC","updated_at":"2016-06-21 23:38:23 UTC","milestone_id":null,"state":"opened","merge_status":"can_be_merged","target_project_id":82,"iid":10,"description":"Some original body content.","position":0,"locked_at":null,"updated_by_id":null,"merge_error":null,"merge_params":{"force_remove_source_branch":"1"},"merge_when_build_succeeds":false,"merge_user_id":null,"merge_commit_sha":null,"deleted_at":null,"source":{"name":"TestProject","description":"","web_url":"https://example.gitlab.lan/meilya/testproject","avatar_url":null,"git_ssh_url":"git@example.gitlab.lan:meilya/testproject.git","git_http_url":"https://example.gitlab.lan/meilya/testproject.git","namespace":"meilya","visibility_level":0,"path_with_namespace":"meilya/testproject","default_branch":"master","homepage":"https://example.gitlab.lan/meilya/testproject","url":"git@example.gitlab.lan:meilya/testproject.git","ssh_url":"git@example.gitlab.lan:meilya/testproject.git","http_url":"https://example.gitlab.lan/meilya/testproject.git"},"target":{"name":"TestProject","description":"","web_url":"https://example.gitlab.lan/meilya/testproject","avatar_url":null,"git_ssh_url":"git@example.gitlab.lan:meilya/testproject.git","git_http_url":"https://example.gitlab.lan/meilya/testproject.git","namespace":"meilya","visibility_level":0,"path_with_namespace":"meilya/testproject","default_branch":"master","homepage":"https://example.gitlab.lan/meilya/testproject","url":"git@example.gitlab.lan:meilya/testproject.git","ssh_url":"git@example.gitlab.lan:meilya/testproject.git","http_url":"https://example.gitlab.lan/meilya/testproject.git"},"last_commit":{"id":"5c73f27b85b0c59d41765ae8b19580fe9e430ac7","message":"updated redmine; closes #1111111\n","timestamp":"2015-03-04T10:41:14-05:00","url":"https://example.gitlab.lan/meilya/testproject/commit/5c73f27b85b0c59d41765ae8b19580fe9e430ac7","author":{"name":"Adam Meily","email":"meilya@ainfosec.com"}},"work_in_progress":false}},
        {"object_kind":"merge_request","user":{"name":"Adam Meily","username":"meilya","avatar_url":"https://example.gitlab.lan/uploads/user/avatar/6/walter.jpg"},"project":{"name":"TestProject","description":"","web_url":"https://example.gitlab.lan/meilya/testproject","avatar_url":null,"git_ssh_url":"git@example.gitlab.lan:meilya/testproject.git","git_http_url":"https://example.gitlab.lan/meilya/testproject.git","namespace":"meilya","visibility_level":0,"path_with_namespace":"meilya/testproject","default_branch":"master","homepage":"https://example.gitlab.lan/meilya/testproject","url":"git@example.gitlab.lan:meilya/testproject.git","ssh_url":"git@example.gitlab.lan:meilya/testproject.git","http_url":"https://example.gitlab.lan/meilya/testproject.git"},"object_attributes":{"id":560,"target_branch":"master","source_branch":"branch2","source_project_id":82,"author_id":6,"assignee_id":null,"title":"updated redmine; closes #1111111","created_at":"2016-06-21 23:34:32 UTC","updated_at":"2016-06-21 23:40:35 UTC","milestone_id":null,"state":"opened","merge_status":"can_be_merged","target_project_id":82,"iid":10,"description":"Some original body content.\r\n\r\na new body.","position":0,"locked_at":null,"updated_by_id":6,"merge_error":null,"merge_params":{"force_remove_source_branch":"1"},"merge_when_build_succeeds":false,"merge_user_id":null,"merge_commit_sha":null,"deleted_at":null,"source":{"name":"TestProject","description":"","web_url":"https://example.gitlab.lan/meilya/testproject","avatar_url":null,"git_ssh_url":"git@example.gitlab.lan:meilya/testproject.git","git_http_url":"https://example.gitlab.lan/meilya/testproject.git","namespace":"meilya","visibility_level":0,"path_with_namespace":"meilya/testproject","default_branch":"master","homepage":"https://example.gitlab.lan/meilya/testproject","url":"git@example.gitlab.lan:meilya/testproject.git","ssh_url":"git@example.gitlab.lan:meilya/testproject.git","http_url":"https://example.gitlab.lan/meilya/testproject.git"},"target":{"name":"TestProject","description":"","web_url":"https://example.gitlab.lan/meilya/testproject","avatar_url":null,"git_ssh_url":"git@example.gitlab.lan:meilya/testproject.git","git_http_url":"https://example.gitlab.lan/meilya/testproject.git","namespace":"meilya","visibility_level":0,"path_with_namespace":"meilya/testproject","default_branch":"master","homepage":"https://example.gitlab.lan/meilya/testproject","url":"git@example.gitlab.lan:meilya/testproject.git","ssh_url":"git@example.gitlab.lan:meilya/testproject.git","http_url":"https://example.gitlab.lan/meilya/testproject.git"},"last_commit":{"id":"5c73f27b85b0c59d41765ae8b19580fe9e430ac7","message":"updated redmine; closes #1111111\n","timestamp":"2015-03-04T10:41:14-05:00","url":"https://example.gitlab.lan/meilya/testproject/commit/5c73f27b85b0c59d41765ae8b19580fe9e430ac7","author":{"name":"Adam Meily","email":"meilya@ainfosec.com"}},"work_in_progress":false,"url":"https://example.gitlab.lan/meilya/testproject/merge_requests/10","action":"update"},"repository":{"name":"TestProject","url":"git@example.gitlab.lan:meilya/testproject.git","description":"","homepage":"https://example.gitlab.lan/meilya/testproject"}},
        {"object_kind":"push","event_name":"push","before":"5c73f27b85b0c59d41765ae8b19580fe9e430ac7","after":"eaa2c94dddd5d74575c8bcc1311f4bc4329c29db","ref":"refs/heads/branch2","checkout_sha":"eaa2c94dddd5d74575c8bcc1311f4bc4329c29db","message":null,"user_id":6,"user_name":"Adam Meily","user_email":"meilya@ainfosec.com","user_avatar":"https://example.gitlab.lan/uploads/user/avatar/6/walter.jpg","project_id":82,"project":{"name":"TestProject","description":"","web_url":"https://example.gitlab.lan/meilya/testproject","avatar_url":null,"git_ssh_url":"git@example.gitlab.lan:meilya/testproject.git","git_http_url":"https://example.gitlab.lan/meilya/testproject.git","namespace":"meilya","visibility_level":0,"path_with_namespace":"meilya/testproject","default_branch":"master","homepage":"https://example.gitlab.lan/meilya/testproject","url":"git@example.gitlab.lan:meilya/testproject.git","ssh_url":"git@example.gitlab.lan:meilya/testproject.git","http_url":"https://example.gitlab.lan/meilya/testproject.git"},"commits":[{"id":"eaa2c94dddd5d74575c8bcc1311f4bc4329c29db","message":"an additional commit message\n\nSome extra long body\n","timestamp":"2016-06-21T19:43:54-04:00","url":"https://example.gitlab.lan/meilya/testproject/commit/eaa2c94dddd5d74575c8bcc1311f4bc4329c29db","author":{"name":"Adam Meily","email":"meilya@ainfosec.com"},"added":[],"modified":["Redmine"],"removed":[]}],"total_commits_count":1,"repository":{"name":"TestProject","url":"git@example.gitlab.lan:meilya/testproject.git","description":"","homepage":"https://example.gitlab.lan/meilya/testproject","git_http_url":"https://example.gitlab.lan/meilya/testproject.git","git_ssh_url":"git@example.gitlab.lan:meilya/testproject.git","visibility_level":0}},
        {"object_kind":"merge_request","user":{"name":"Adam Meily","username":"meilya","avatar_url":"https://example.gitlab.lan/uploads/user/avatar/6/walter.jpg"},"project":{"name":"TestProject","description":"","web_url":"https://example.gitlab.lan/meilya/testproject","avatar_url":null,"git_ssh_url":"git@example.gitlab.lan:meilya/testproject.git","git_http_url":"https://example.gitlab.lan/meilya/testproject.git","namespace":"meilya","visibility_level":0,"path_with_namespace":"meilya/testproject","default_branch":"master","homepage":"https://example.gitlab.lan/meilya/testproject","url":"git@example.gitlab.lan:meilya/testproject.git","ssh_url":"git@example.gitlab.lan:meilya/testproject.git","http_url":"https://example.gitlab.lan/meilya/testproject.git"},"object_attributes":{"id":561,"target_branch":"master","source_branch":"branch2","source_project_id":82,"author_id":6,"assignee_id":6,"title":"Branch2","created_at":"2016-06-21 23:50:18 UTC","updated_at":"2016-06-21 23:52:32 UTC","milestone_id":null,"state":"merged","merge_status":"can_be_merged","target_project_id":82,"iid":11,"description":"Take 2.\r\n\r\nasdf","position":0,"locked_at":null,"updated_by_id":6,"merge_error":null,"merge_params":{"force_remove_source_branch":null},"merge_when_build_succeeds":false,"merge_user_id":null,"merge_commit_sha":"358c7be6a7e6527578000c46f233161a9a9e3398","deleted_at":null,"source":{"name":"TestProject","description":"","web_url":"https://example.gitlab.lan/meilya/testproject","avatar_url":null,"git_ssh_url":"git@example.gitlab.lan:meilya/testproject.git","git_http_url":"https://example.gitlab.lan/meilya/testproject.git","namespace":"meilya","visibility_level":0,"path_with_namespace":"meilya/testproject","default_branch":"master","homepage":"https://example.gitlab.lan/meilya/testproject","url":"git@example.gitlab.lan:meilya/testproject.git","ssh_url":"git@example.gitlab.lan:meilya/testproject.git","http_url":"https://example.gitlab.lan/meilya/testproject.git"},"target":{"name":"TestProject","description":"","web_url":"https://example.gitlab.lan/meilya/testproject","avatar_url":null,"git_ssh_url":"git@example.gitlab.lan:meilya/testproject.git","git_http_url":"https://example.gitlab.lan/meilya/testproject.git","namespace":"meilya","visibility_level":0,"path_with_namespace":"meilya/testproject","default_branch":"master","homepage":"https://example.gitlab.lan/meilya/testproject","url":"git@example.gitlab.lan:meilya/testproject.git","ssh_url":"git@example.gitlab.lan:meilya/testproject.git","http_url":"https://example.gitlab.lan/meilya/testproject.git"},"last_commit":{"id":"eaa2c94dddd5d74575c8bcc1311f4bc4329c29db","message":"an additional commit message\n\nSome extra long body\n","timestamp":"2016-06-21T19:43:54-04:00","url":"https://example.gitlab.lan/meilya/testproject/commit/eaa2c94dddd5d74575c8bcc1311f4bc4329c29db","author":{"name":"Adam Meily","email":"meilya@ainfosec.com"}},"work_in_progress":false,"url":"https://example.gitlab.lan/meilya/testproject/merge_requests/11","action":"merge"},"repository":{"name":"TestProject","url":"git@example.gitlab.lan:meilya/testproject.git","description":"","homepage":"https://example.gitlab.lan/meilya/testproject"},"assignee":{"name":"Adam Meily","username":"meilya","avatar_url":"https://example.gitlab.lan/uploads/user/avatar/6/walter.jpg"}},
        {"object_kind":"merge_request","user":{"name":"Adam Meily","username":"meilya","avatar_url":"https://example.gitlab.lan/uploads/user/avatar/6/walter.jpg"},"project":{"name":"TestProject","description":"","web_url":"https://example.gitlab.lan/meilya/testproject","avatar_url":null,"git_ssh_url":"git@example.gitlab.lan:meilya/testproject.git","git_http_url":"https://example.gitlab.lan/meilya/testproject.git","namespace":"meilya","visibility_level":0,"path_with_namespace":"meilya/testproject","default_branch":"master","homepage":"https://example.gitlab.lan/meilya/testproject","url":"git@example.gitlab.lan:meilya/testproject.git","ssh_url":"git@example.gitlab.lan:meilya/testproject.git","http_url":"https://example.gitlab.lan/meilya/testproject.git"},"object_attributes":{"id":560,"target_branch":"master","source_branch":"branch2","source_project_id":82,"author_id":6,"assignee_id":null,"title":"updated redmine; closes #1111111","created_at":"2016-06-21 23:34:32 UTC","updated_at":"2016-06-21 23:48:40 UTC","milestone_id":null,"state":"closed","merge_status":"unchecked","target_project_id":82,"iid":10,"description":"Some original body content.\r\n\r\na new body.","position":0,"locked_at":null,"updated_by_id":6,"merge_error":null,"merge_params":{"force_remove_source_branch":null},"merge_when_build_succeeds":false,"merge_user_id":null,"merge_commit_sha":null,"deleted_at":null,"source":{"name":"TestProject","description":"","web_url":"https://example.gitlab.lan/meilya/testproject","avatar_url":null,"git_ssh_url":"git@example.gitlab.lan:meilya/testproject.git","git_http_url":"https://example.gitlab.lan/meilya/testproject.git","namespace":"meilya","visibility_level":0,"path_with_namespace":"meilya/testproject","default_branch":"master","homepage":"https://example.gitlab.lan/meilya/testproject","url":"git@example.gitlab.lan:meilya/testproject.git","ssh_url":"git@example.gitlab.lan:meilya/testproject.git","http_url":"https://example.gitlab.lan/meilya/testproject.git"},"target":{"name":"TestProject","description":"","web_url":"https://example.gitlab.lan/meilya/testproject","avatar_url":null,"git_ssh_url":"git@example.gitlab.lan:meilya/testproject.git","git_http_url":"https://example.gitlab.lan/meilya/testproject.git","namespace":"meilya","visibility_level":0,"path_with_namespace":"meilya/testproject","default_branch":"master","homepage":"https://example.gitlab.lan/meilya/testproject","url":"git@example.gitlab.lan:meilya/testproject.git","ssh_url":"git@example.gitlab.lan:meilya/testproject.git","http_url":"https://example.gitlab.lan/meilya/testproject.git"},"last_commit":{"id":"eaa2c94dddd5d74575c8bcc1311f4bc4329c29db","message":"an additional commit message\n\nSome extra long body\n","timestamp":"2016-06-21T19:43:54-04:00","url":"https://example.gitlab.lan/meilya/testproject/commit/eaa2c94dddd5d74575c8bcc1311f4bc4329c29db","author":{"name":"Adam Meily","email":"meilya@ainfosec.com"}},"work_in_progress":false,"url":"https://example.gitlab.lan/meilya/testproject/merge_requests/10","action":"close"},"repository":{"name":"TestProject","url":"git@example.gitlab.lan:meilya/testproject.git","description":"","homepage":"https://example.gitlab.lan/meilya/testproject"}}
      ];

      $(document).ready(function() {
        var app = new Metyl.Application();
        var i = 0;
        var interval = setInterval(function() {
          if(i < TestEvents.length) {
            app.process({
              origin: "example.gitlab.lan",
              data: TestEvents[i]
            });
            i += 1;
          } else {
            clearInterval(interval);
          }
        }, 1000);

        app.on('eventItem', function(elementName, event) {
          var element = document.createElement(elementName);
          element.data = event.data;
          element.origin = event.origin;
          element.style.display = "none";

          $("#event-list").prepend(element);
          element.show();
        });
      });
